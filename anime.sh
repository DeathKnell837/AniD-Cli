#!/bin/bash\n\n# üéå ANIME STREAMING & DOWNLOAD MANAGER\n# Fixed for Android 13 - Uses accessible Termux directories\n# Enhanced with Download All Episodes, Delete All Episodes, and Move to Visible Storage\n\n# Colors for better UI\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[0;33m'\nBLUE='\\033[0;34m'\nPURPLE='\\033[0;35m'\nCYAN='\\033[0;36m'\nWHITE='\\033[0;37m'\nBOLD='\\033[1m'\nRESET='\\033[0m'\n\n# Set anime directory to accessible location\nANIME_DIR=\"$HOME/anime\"\nDOWNLOADS_DIR=\"$ANIME_DIR/downloads\"\n\n# Create directories if they don't exist\nmkdir -p \"$DOWNLOADS_DIR\"\nmkdir -p \"$ANIME_DIR/watching\"\nmkdir -p \"$ANIME_DIR/completed\"\nmkdir -p \"$ANIME_DIR/plan_to_watch\"\n\nclear\necho -e \"${BOLD}${PURPLE}üéå ANIME STREAMING & DOWNLOAD MANAGER üéå${RESET}\"\necho -e \"${CYAN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${RESET}\"\necho -e \"${GREEN}üìÅ Anime Directory: $ANIME_DIR${RESET}\"\necho -e \"${GREEN}üì• Downloads: $DOWNLOADS_DIR${RESET}\"\necho \"\"\n\n# Check if ani-cli is installed\nif [ ! -f \"$HOME/.local/bin/ani-cli\" ]; then\n    echo -e \"${YELLOW}‚ö†Ô∏è  ani-cli not found. Installing...${RESET}\"\n    mkdir -p ~/.local/bin\n    curl -sL https://github.com/pystardust/ani-cli/raw/master/ani-cli -o ~/.local/bin/ani-cli\n    chmod +x ~/.local/bin/ani-cli\n    echo -e \"${GREEN}‚úÖ ani-cli installed successfully!${RESET}\"\n    echo \"\"\nfi\n\n# Show menu\necho -e \"${BOLD}${WHITE}Choose an option:${RESET}\"\necho -e \"${CYAN}[1]${RESET} üé¨ Stream Anime (watch online)\"\necho -e \"${CYAN}[2]${RESET} üì• Download Specific Episodes (choose episodes)\"\necho -e \"${CYAN}[3]${RESET} üì¶ Download All Episodes (entire anime series)\"\necho -e \"${CYAN}[4]${RESET} üìÅ Manage Downloads (view/play downloaded anime)\"\necho -e \"${CYAN}[5]${RESET} üì¶ Move to Visible Storage (copy to file manager accessible location)\"\necho -e \"${CYAN}[6]${RESET} üìä Show Anime Directory Info\"\necho -e \"${CYAN}[7]${RESET} üîß Open File Manager\"\necho -e \"${CYAN}[8]${RESET} üóëÔ∏è Delete All Episodes (remove all downloads)\"\necho -e \"${CYAN}[9]${RESET} ‚ùå Exit\"\necho \"\"\nprintf \"${BOLD}Enter choice [1-9]: ${RESET}\"\nread -r choice\n\ncase $choice in\n    1)\n        echo -e \"${GREEN}üé¨ Launching anime streaming...${RESET}\"\n        echo -e \"${YELLOW}üí° This will stream anime online (uses data)${RESET}\"\n        cd \"$DOWNLOADS_DIR\"\n        PATH=\"$HOME/.local/bin:$PATH\" ~/.local/bin/ani-cli\n        ;;\n    2)\n        echo -e \"${GREEN}üì• Launching anime download mode...${RESET}\"\n        echo -e \"${YELLOW}üí° Downloads will be saved to: $DOWNLOADS_DIR${RESET}\"\n        echo -e \"${CYAN}üí° You can choose specific episodes to download${RESET}\"\n        cd \"$DOWNLOADS_DIR\"\n        PATH=\"$HOME/.local/bin:$PATH\" ~/.local/bin/ani-cli -d\n        ;;\n    3)\n        echo -e \"${GREEN}üì¶ Launching download ALL episodes mode...${RESET}\"\n        echo -e \"${YELLOW}üí° Downloads will be saved to: $DOWNLOADS_DIR${RESET}\"\n        echo -e \"${GREEN}üéÜ Just enter anime name - ALL episodes download automatically!${RESET}\"\n        echo -e \"${RED}‚ö†Ô∏è  This will download ALL episodes of the selected anime!${RESET}\"\n        echo -e \"${RED}‚ö†Ô∏è  This may use a lot of data and take a long time!${RESET}\"\n        echo \"\"\n        printf \"${BOLD}Continue with downloading all episodes? [y/N]: ${RESET}\"\n        read -r download_all_choice\n        \n        if [[ \"$download_all_choice\" =~ ^[Yy]$ ]]; then\n            echo -e \"${CYAN}üéÜ Just enter anime name - ALL episodes download automatically!${RESET}\"\n            echo -e \"${CYAN}üìù Select anime from search results${RESET}\"\n            echo -e \"${CYAN}‚ú® ALL episodes download automatically - no numbers needed!${RESET}\"\n            echo \"\"\n            printf \"${BOLD}Enter anime name to search: ${RESET}\"\n            read -r anime_search\n            \n            if [ -n \"$anime_search\" ]; then\n                echo -e \"${GREEN}üîç Searching for: $anime_search${RESET}\"\n                echo -e \"${CYAN}üí° When prompted for episodes, enter range like '1-25' for all episodes${RESET}\"\n                echo \"\"\n                cd \"$DOWNLOADS_DIR\"\n                PATH=\"$HOME/.local/bin:$PATH\" ~/.local/bin/ani-cli -d -e \"1-999\" \"$anime_search\"\n            else\n                echo -e \"${RED}No anime name provided${RESET}\"\n            fi\n        else\n            echo -e \"${CYAN}‚ùå Download cancelled${RESET}\"\n        fi\n        ;;\n    4)\n        echo -e \"${GREEN}üìÅ Managing downloaded anime...${RESET}\"\n        anime_count=$(find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) 2>/dev/null | wc -l)\n        \n        if [ \"$anime_count\" -eq 0 ]; then\n            echo -e \"${YELLOW}üì≠ No anime files found in downloads directory.${RESET}\"\n            echo -e \"${CYAN}üí° Use option 2 or 3 to download anime episodes.${RESET}\"\n        else\n            echo -e \"${GREEN}üìä Found $anime_count anime files:${RESET}\"\n            echo \"\"\n            find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) -exec basename {} \\; 2>/dev/null | nl\n            echo \"\"\n            echo -e \"${CYAN}üí° Use a video player app to watch these files.${RESET}\"\n            \n            if command -v termux-open &> /dev/null; then\n                printf \"${BOLD}Open downloads folder? [Y/n]: ${RESET}\"\n                read -r open_choice\n                if [[ ! \"$open_choice\" =~ ^[Nn]$ ]]; then\n                    termux-open \"$DOWNLOADS_DIR\"\n                fi\n            fi\n        fi\n        ;;\n    5)\n        echo -e \"${GREEN}üì¶ Moving anime to visible storage...${RESET}\"\n        anime_count=$(find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) 2>/dev/null | wc -l)\n        \n        if [ \"$anime_count\" -eq 0 ]; then\n            echo -e \"${YELLOW}üì¶ No anime files found to move.${RESET}\"\n        else\n            echo -e \"${CYAN}üì¶ Found $anime_count anime files to move${RESET}\"\n            echo \"\"\n            \n            # Use the confirmed accessible location\n            target_dir=\"/storage/emulated/0/Download\"\n            if [ -d \"$target_dir\" ] && [ -w \"$target_dir\" ]; then\n                success=true\n            else\n                success=false\n            fi\n            \n            if [ \"$success\" = true ]; then\n                echo -e \"${GREEN}‚úÖ Target directory: $target_dir${RESET}\"\n                echo \"\"\n                echo -e \"${BOLD}Choose transfer method:${RESET}\"\n                echo -e \"${CYAN}[1] Copy files (keep originals in Termux)${RESET}\"\n                echo -e \"${CYAN}[2] Move files (delete originals, save storage)${RESET}\"\n                printf \"${BOLD}Enter choice [1-2]: ${RESET}\"\n                read -r transfer_choice\n                \n                transfer_cmd=\"cp\"\n                transfer_action=\"Copying\"\n                storage_note=\"Files copied (originals remain in Termux)\"\n                \n                if [ \"$transfer_choice\" = \"2\" ]; then\n                    transfer_cmd=\"mv\"\n                    transfer_action=\"Moving\"\n                    storage_note=\"Files moved (originals deleted from Termux to save storage)\"\n                fi\n                \n                echo -e \"${CYAN}üì¶ $transfer_action anime files...${RESET}\"\n                \n                # Transfer files to accessible location\n                find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) -exec $transfer_cmd {} \"$target_dir/\" \\; 2>/dev/null\n                \n                if [ $? -eq 0 ]; then\n                    echo -e \"${GREEN}‚úÖ Successfully transferred $anime_count anime files!${RESET}\"\n                    echo -e \"${GREEN}üìÅ Files now visible at: $target_dir${RESET}\"\n                    echo -e \"${GREEN}üì± You can now see them in your file manager!${RESET}\"\n                    echo -e \"${BLUE}üíæ Storage: $storage_note${RESET}\"\n                    \n                    if command -v termux-open &> /dev/null; then\n                        printf \"${BOLD}Open the new location in file manager? [Y/n]: ${RESET}\"\n                        read -r open_new_choice\n                        if [[ ! \"$open_new_choice\" =~ ^[Nn]$ ]]; then\n                            termux-open \"$target_dir\"\n                            echo -e \"${GREEN}‚úÖ File manager opened to visible anime location!${RESET}\"\n                        fi\n                    fi\n                else\n                    echo -e \"${RED}‚ö†Ô∏è  Failed to transfer files to visible storage${RESET}\"\n                fi\n            else\n                echo -e \"${RED}‚ö†Ô∏è  Could not access visible storage directory${RESET}\"\n                echo -e \"${CYAN}üí° Files remain in Termux internal storage${RESET}\"\n                echo -e \"${CYAN}üí° Use termux-open to play videos${RESET}\"\n            fi\n        fi\n        ;;\n    6)\n        echo -e \"${GREEN}üìä Anime Directory Information:${RESET}\"\n        echo \"\"\n        echo -e \"${CYAN}üìÅ Main Directory:${RESET} $ANIME_DIR\"\n        echo -e \"${CYAN}üì• Downloads:${RESET} $DOWNLOADS_DIR\"\n        echo -e \"${CYAN}üëÄ Watching:${RESET} $ANIME_DIR/watching\"\n        echo -e \"${CYAN}‚úÖ Completed:${RESET} $ANIME_DIR/completed\"\n        echo -e \"${CYAN}üìã Plan to Watch:${RESET} $ANIME_DIR/plan_to_watch\"\n        echo \"\"\n        \n        # Count files in each directory\n        downloads_count=$(find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) 2>/dev/null | wc -l)\n        total_size=$(du -sh \"$ANIME_DIR\" 2>/dev/null | cut -f1 || echo \"0B\")\n        \n        echo -e \"${GREEN}üìà Statistics:${RESET}\"\n        echo -e \"${WHITE}‚Ä¢ Downloaded Episodes: $downloads_count${RESET}\"\n        echo -e \"${WHITE}‚Ä¢ Total Size: $total_size${RESET}\"\n        echo -e \"${WHITE}‚Ä¢ Directory accessible from file managers${RESET}\"\n        ;;\n    7)\n        echo -e \"${GREEN}üîß Opening file manager...${RESET}\"\n        if command -v termux-open &> /dev/null; then\n            termux-open \"$ANIME_DIR\"\n            echo -e \"${GREEN}‚úÖ File manager opened to anime directory${RESET}\"\n        else\n            echo -e \"${YELLOW}‚ö†Ô∏è  termux-open not available${RESET}\"\n            echo -e \"${CYAN}üí° Navigate to: $ANIME_DIR${RESET}\"\n            echo -e \"${CYAN}üí° Install termux-api for file manager integration: pkg install termux-api${RESET}\"\n        fi\n        ;;\n    8)\n        echo -e \"${GREEN}üóëÔ∏è Delete episodes options...${RESET}\"\n        anime_count=$(find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) 2>/dev/null | wc -l)\n        \n        if [ \"$anime_count\" -eq 0 ]; then\n            echo -e \"${YELLOW}üì¶ No anime files found in Termux to delete.${RESET}\"\n            echo -e \"${CYAN}üí° Note: Episodes in Downloads folder (if any) remain accessible${RESET}\"\n        else\n            echo -e \"${RED}‚ö†Ô∏è  DELETE OPTIONS${RESET}\"\n            echo \"\"\n            echo -e \"${CYAN}[1] Delete from Termux only (keep visible episodes)${RESET}\"\n            echo -e \"${CYAN}[2] Delete from visible storage only (keep Termux episodes)${RESET}\"\n            echo -e \"${CYAN}[3] Delete from EVERYWHERE (Termux + visible storage)${RESET}\"\n            echo -e \"${CYAN}[4] Cancel${RESET}\"\n            printf \"${BOLD}Enter choice [1-4]: ${RESET}\"\n            read -r delete_option\n            \n            case $delete_option in\n                1)\n                    echo -e \"${RED}‚ö†Ô∏è  This will DELETE $anime_count episodes from Termux only!${RESET}\"\n                    echo -e \"${GREEN}üì± Episodes in Downloads folder will remain visible${RESET}\"\n                    printf \"${BOLD}Continue? [y/N]: ${RESET}\"\n                    read -r delete_choice\n                    \n                    if [[ \"$delete_choice\" =~ ^[Yy]$ ]]; then\n                        find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) -delete 2>/dev/null\n                        echo -e \"${GREEN}‚úÖ Deleted $anime_count episodes from Termux!${RESET}\"\n                        echo -e \"${CYAN}üì± Episodes in Downloads folder remain accessible${RESET}\"\n                    fi\n                    ;;\n                2)\n                    echo -e \"${RED}‚ö†Ô∏è  This will DELETE episodes from visible storage!${RESET}\"\n                    echo -e \"${GREEN}üíæ Episodes in Termux will remain${RESET}\"\n                    printf \"${BOLD}Continue? [y/N]: ${RESET}\"\n                    read -r delete_choice\n                    \n                    if [[ \"$delete_choice\" =~ ^[Yy]$ ]]; then\n                        printf \"${RED}Type 'DELETE' to confirm: ${RESET}\"\n                        read -r final_confirm\n                        if [ \"$final_confirm\" = \"DELETE\" ]; then\n                            find \"/storage/emulated/0/Download\" -name \"*Summertime*\" -name \"*.mp4\" -delete 2>/dev/null\n                            echo -e \"${GREEN}‚úÖ Deleted episodes from visible storage!${RESET}\"\n                        fi\n                    fi\n                    ;;\n                3)\n                    echo -e \"${RED}‚ö†Ô∏è  This will DELETE ALL episodes from EVERYWHERE!${RESET}\"\n                    echo -e \"${RED}‚ö†Ô∏è  Termux + visible storage + everywhere!${RESET}\"\n                    printf \"${BOLD}Are you absolutely sure? [y/N]: ${RESET}\"\n                    read -r delete_choice\n                    \n                    if [[ \"$delete_choice\" =~ ^[Yy]$ ]]; then\n                        printf \"${RED}Final confirmation - Type 'DELETE' to confirm: ${RESET}\"\n                        read -r final_confirm\n                        \n                        if [ \"$final_confirm\" = \"DELETE\" ]; then\n                            # Delete from Termux\n                            find \"$DOWNLOADS_DIR\" -type f \\( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" \\) -delete 2>/dev/null\n                            # Delete from visible storage\n                            find \"/storage/emulated/0/Download\" -name \"*Summertime*\" -name \"*.mp4\" -delete 2>/dev/null\n                            echo -e \"${GREEN}‚úÖ Deleted $anime_count episodes from Termux!${RESET}\"\n                            echo -e \"${GREEN}‚úÖ Deleted episodes from visible storage!${RESET}\"\n                            echo -e \"${CYAN}üìÅ ALL anime files removed from everywhere${RESET}\"\n                        else\n                            echo -e \"${CYAN}‚ùå Deletion cancelled${RESET}\"\n                        fi\n                    else\n                        echo -e \"${CYAN}‚ùå Deletion cancelled${RESET}\"\n                    fi\n                    ;;\n                4|*)\n                    echo -e \"${CYAN}‚ùå Deletion cancelled${RESET}\"\n                    ;;\n            esac\n        fi\n        ;;\n    9)\n        echo -e \"${GREEN}üëã Goodbye! Happy anime watching! üéå${RESET}\"\n        exit 0\n        ;;\n    *)\n        echo -e \"${RED}‚ùå Invalid choice. Please run the script again.${RESET}\"\n        exit 1\n        ;;\nesac\n\necho \"\"\necho -e \"${GREEN}‚úÖ Operation completed!${RESET}\"\necho -e \"${CYAN}üí° Run './anime.sh' again to access more options${RESET}\"\n"